%
% @author Michal Koutný <michal@fykos.cz>
% @author Jan Houštěk (2002/6)
%
% This work is licenced under CC BY-SA 3.0 licence.
% Full form can be found at http://creativecommons.org/licenses/by-sa/3.0/.
%
% @description Various macros for more comfortable writing
%              of mathematical stuff. Based on mathstuff.sty
%              by Jan Houštěk.
% @note If you use this package separately with XeLaTeX, load it prior xltxtra package.
% @note If you use 'babel' package, unit convenience macro will block macros
%       that use active double quote (") char.
%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{fkssugar}[2011/09/11 FYKOS comfort macros]

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{ifthen}
\RequirePackage{lmodern}
\RequirePackage{xparse}
\RequirePackage{bbding}
\RequirePackage[nointegrals]{wasysym}

\DeclareMathAlphabet{\mathup}{OT1}{\familydefault}{m}{n} % stojate pismo v matematice

\let\underscore\_                                       % underscore sign
\let\xor\^                                              % xor sign
\renewcommand\_[1]{\ifmmode _{\scriptsize\textnormal{#1}}\else\underscore#1\fi} %roman subscript
\renewcommand\^[1]{\ifmmode ^{\scriptsize\textnormal{#1}}\else\xor#1\fi} %roman superscript

\def\({\left(} \def\){\right)}                          % parentheses
\newcommand\ztoho{\quad\Rightarrow\quad}                % implication
\newcommand\frc[2]{\dfrac#1#2}                          % non-reduced fractions [obsolete]
\newcommand\tsum{\mathop{\textnormalstyle\sum}\limits}  % inline sum
\newcommand\tprod{\mathop{\textnormalstyle\prod}\limits}% inline product
\newcommand\tint{\mathop{\textnormalstyle\int}\nolimits}% inline integral
\newcommand\const{\textnormal{konst}}                   % konstanta
\newcommand\dg{^\circ}                                  % stupen
\def\C{^\circ\mskip-2mu\mathup{C}}                      % Celsiuv stupen
\let\Re\relax\DeclareMathOperator\Re{Re}                % realna cast
\let\Im\relax\DeclareMathOperator\Im{Im}                % imaginarni cast
\newcommand\eu{\mathup{e}}                              % Eulerovo cislo
\newcommand\im{\mathup{i}}                              % imaginarni jednotka
\renewcommand\d{\mathup{d}}                             % differential sign
\newcommand\der[2]{\frac{\d #1}{\d #2}}                 % prvni derivace
\newcommand\dder[2]{\frac{\d^2 #1}{\d #2^2}}            % druha derivace
\newcommand\pder[2]{\frac%                              % prvni parcialni derivace
    {\partial#1}{\partial#2}}
\newcommand\ppder[2]{\frac%                             % prvni parcialni derivace
    {\partial^2#1}{\partial#2^2}}
\DeclareMathOperator\tg{tg}                             % cesky tangens
\let\tan\relax\DeclareMathOperator\tan{tg}
\DeclareMathOperator\cotg{cotg}                         % cesky cotangens
\let\cot\relax\DeclareMathOperator\cot{cotg}
\DeclareMathOperator\cosec{cosec}                       % cesky kosecans
\let\csc\relax\DeclareMathOperator\csc{cosec}
\DeclareMathOperator\arctg{arctg}                       % cesky arcustangens
\let\arctan\relax\DeclareMathOperator\arctan{arctg}
\DeclareMathOperator\arccotg{arccotg}                   % cesky arcuscotangens
\DeclareMathOperator\arccot{arccotg}
\DeclareMathOperator\tgh{tgh}                           % cesky hyp. tangens
\let\tanh\relax\DeclareMathOperator\tanh{tgh}
\DeclareMathOperator\argcosh{argcosh}                   % cesky inverzni hyp. cosinus
\DeclareMathOperator\argsinh{argsinh}                   % cesky inverzni hyp. sinus
\DeclareMathOperator\argtgh{argtgh}                     % cesky inverzni hyp. tangens
\DeclareMathOperator\argtanh{argtgh}
\DeclareMathOperator\argcotgh{argcotgh}                 % cesky inverzni hyp. sinus
\DeclareMathOperator\argcoth{argcotgh}                  % cesky inverzni hyp. sinus
\DeclareMathOperator\tr{Tr}                             % stopa
\DeclareMathOperator\sgn{sgn}                           % funkce signum
\newcommand\Laplace{\Delta}                             % trojuhelnickovity operator
\DeclareMathOperator\rot{rot}                           % rotace
\DeclareMathOperator\Div{div}                           % divergence
\DeclareMathOperator\grad{grad}                         % gradient
\DeclareMathOperator\Dalembert{\Box}                    % operátor D'Alembert
\newcommand\prumer{\varnothing}                         % [obsolete]
\newcommand\eqdef{\stackrel{\mathup{def}}{=}}           % definition equality
\providecommand\qed{\hfill\square}			% konec dukazu, podmínění kvůli beameru
\newcommand\bod[1]{\mathsf{#1}}                         % geometric point
\newcommand\bb[1]{\mathbb{#1}}                          % blackboard bold
\newcommand\op[1]{\mathup{#1}}                          % operators
\newcommand\abs[1]{\left|#1\right|}                     % absolutní hodnota
\newcommand\conj[1]{#1^\ast}                            % komplexní sdružení

% intervaly
\newcommand{\ointo}[2]{\(#1,#2\)}
\newcommand{\ointc}[2]{\!\left.\(#1,#2\right\rangle\right.\!}
\newcommand{\cinto}[2]{\!\left.\left\langle#1,#2\)\right.\!}
\newcommand{\cintc}[2]{\left\langle#1,#2\right\rangle}

% footnote nad interpunkci
\newcommand{\footnotei}[2]{%
\setbox0\hbox{#1}%
\copy0%
\hspace{-\wd0}%
\footnote{#2}%
}

% -- greek letters --

%bold serif italic greek font for vectors (from isomath.sty and fixmath.sty)
\DeclareMathSymbol{\fksGamma}{\mathalpha}{letters}{0}
\DeclareMathSymbol{\fksDelta}{\mathalpha}{letters}{1}
\DeclareMathSymbol{\fksTheta}{\mathalpha}{letters}{2}
\DeclareMathSymbol{\fksLambda}{\mathalpha}{letters}{3}
\DeclareMathSymbol{\fksXi}{\mathalpha}{letters}{4}
\DeclareMathSymbol{\fksPi}{\mathalpha}{letters}{5}
\DeclareMathSymbol{\fksSigma}{\mathalpha}{letters}{6}
\DeclareMathSymbol{\fksUpsilon}{\mathalpha}{letters}{7}
\DeclareMathSymbol{\fksPhi}{\mathalpha}{letters}{8}
\DeclareMathSymbol{\fksPsi}{\mathalpha}{letters}{9}
\DeclareMathSymbol{\fksOmega}{\mathalpha}{letters}{10}
\DeclareMathSymbol{\fksalpha}{\mathalpha}{letters}{11}
\DeclareMathSymbol{\fksbeta}{\mathalpha}{letters}{12}
\DeclareMathSymbol{\fksgamma}{\mathalpha}{letters}{13}
\DeclareMathSymbol{\fksdelta}{\mathalpha}{letters}{14}
\DeclareMathSymbol{\fksepsilon}{\mathalpha}{letters}{15}
\DeclareMathSymbol{\fkszeta}{\mathalpha}{letters}{16}
\DeclareMathSymbol{\fkseta}{\mathalpha}{letters}{17}
\DeclareMathSymbol{\fkstheta}{\mathalpha}{letters}{18}
\DeclareMathSymbol{\fksiota}{\mathalpha}{letters}{19}
\DeclareMathSymbol{\fkskappa}{\mathalpha}{letters}{20}
\DeclareMathSymbol{\fkslambda}{\mathalpha}{letters}{21}
\DeclareMathSymbol{\fksmu}{\mathalpha}{letters}{22}
\DeclareMathSymbol{\fksnu}{\mathalpha}{letters}{23}
\DeclareMathSymbol{\fksxi}{\mathalpha}{letters}{24}
\DeclareMathSymbol{\fkspi}{\mathalpha}{letters}{25}
\DeclareMathSymbol{\fksrho}{\mathalpha}{letters}{26}
\DeclareMathSymbol{\fkssigma}{\mathalpha}{letters}{27}
\DeclareMathSymbol{\fkstau}{\mathalpha}{letters}{28}
\DeclareMathSymbol{\fksupsilon}{\mathalpha}{letters}{29}
\DeclareMathSymbol{\fksphi}{\mathalpha}{letters}{30}
\DeclareMathSymbol{\fkschi}{\mathalpha}{letters}{31}
\DeclareMathSymbol{\fkspsi}{\mathalpha}{letters}{32}
\DeclareMathSymbol{\fksomega}{\mathalpha}{letters}{33}

\DeclareMathAlphabet{\vectalpha}{OT1}{\sfdefault}{bx}{sl} % latin vectors alphabet
\DeclareMathAlphabet{\vectgralpha}{OML}{cmbr}{bx}{it}     % greek vectors alphabet

% redefine greek letters to serif, slanted, bold greek letters
\newcommand\sw@pgreekletters[1]{%
%  \renewcommand\Gamma{#1\fksGamma} % stack overflow in caption
  \def\Gamma{#1\fksGamma}
  \def\Delta{#1\fksDelta}
  \def\Theta{#1\fksTheta}
  \def\Lambda{#1\fksLambda}
  \def\Xi{#1\fksXi}
  \def\Pi{#1\fksPi}
  \def\Sigma{#1\fksSigma}
  \def\Upsilon{#1\fksUpsilon}
  \def\Phi{#1\fksPhi}
  \def\Psi{#1\fksPsi}
  \def\Omega{#1\fksOmega}
  \def\alpha{#1\fksalpha}
  \def\beta{#1\fksbeta}
  \def\gamma{#1\fksgamma}
  \def\delta{#1\fksdelta}
  \def\epsilon{#1\fksepsilon}
  \def\zeta{#1\fkszeta}
  \def\eta{#1\fkseta}
  \def\theta{#1\fkstheta}
  \def\iota{#1\fksiota}
  \def\kappa{#1\fkskappa}
  \def\lambda{#1\fkslambda}
  \def\mu{#1\fksmu}
  \def\nu{#1\fksnu}
  \def\xi{#1\fksxi}
  \def\pi{#1\fkspi}
  \def\rho{#1\fksrho}
  \def\sigma{#1\fkssigma}
  \def\tau{#1\fkstau}
  \def\upsilon{#1\fksupsilon}
  \def\phi{#1\fksphi}
  \def\chi{#1\fkschi}
  \def\psi{#1\fkspsi}
  \def\omega{#1\fksomega}
}%
% swap definitions only for vect macro.
\newcommand\vect[1]{\bgroup\sw@pgreekletters\vectgralpha\vectalpha#1\egroup}
\newcommand\vectgr\vect % only for compatibility reasons

%special for upright pi
\let\varpi\pi
\IfFileExists{lgrenc.def}{      % part of babel package
\input{lgrenc.def}
\DeclareMathAlphabet{\grk}{LGR}{cmr}{m}{n}     % upright greek
\renewcommand\pi{\grk{p}}
\newcommand\micro{\grk{m}} %TODO (Xe)LaTeX compatibility, µ (u00b5) has better look
}%
{\PackageWarning{fkssugar}{lgrenc.def file not found using italic pi.}}

\let\oldrho=\rho
\renewcommand\rho{\varrho}
\let\oldepsilon=\epsilon
\renewcommand\epsilon{\varepsilon}
\let\oldtheta=\theta
\renewcommand\theta{\vartheta}
\let\oldphi=\phi
\renewcommand\phi{\varphi}
\newcommand\ohm{\Omega}                                 % for use as an unit
\newcommand\Ohm{\ohm}                                   % Ohm pro Mirka
\newcommand\Kc{\textnormal{Kč}}                         % for use as an unit of CZK
\newcommand\Euro{\textnormal{€}}                        % or use as an unit of EUR

% block equations
\newcommand\eq[2][s]{%
\ifthenelse{\equal{#1}{s}}{%
\begin{equation*}#2\end{equation*}%
}{}%
\ifthenelse{\equal{#1}{m}}{%
\begin{align*}#2\end{align*}%
}{}%
\ignorespaces}

\newcommand\lbl[1]{\stepcounter{equation}\tag{\theequation}\label{#1}}


\def\E #1 {\cdot 10^{#1}}                       % mocnina desitky, to take whole numeric token
\newcommand\my@jd[1]{\begingroup\begingroup\!\jed@B#1@@}
\newcommand\jd[1]{\ensuremath{\my@jd{#1}}} % pro psani samostatnych jednotek (napr. $\jd{m.s^{-1}}$)
\newcommand\popi[2]{{$\dfrac{#1}{\jd{#2}}$}} % labels for graphs/tables
\DeclareExpandableDocumentCommand{\popit}{O{1}O{c}mm}
  {\multicolumn{#1}{#2}{\popi{#3}{#4}}}% labels for tables


% following definition must be loaded after begining of the document
\AtBeginDocument{
% breaking equations according Czech/Russian typography rules (repeat =)
\def\neq {\mathrel{\not=}} % no break @ \neq
\begingroup\lccode`~=`\=\lowercase{\endgroup\newcommand~}{\math@eq\discretionary{}{=}{}}
\mathchardef\math@eq=\mathcode`\=
\mathcode`\=="8000      % = je v matematice aktivni znak
\binoppenalty=10000     % nikde jinde se relace lamat nesmeji
\relpenalty=10000     % nikde jinde se relace lamat nesmeji
% jednodussi psani \cdot
\bgroup\uccode`~=`*\uppercase{\egroup\let~}\cdot
\mathcode`\*="8000

% pohodlne psani cisel a jednotek (napr. $ G = "6.672e-11 N.m^2.kg^{-2}" $)
\begingroup\uccode`~=`e\uppercase{\endgroup\let~}\E   % aktivni e se chova jako \E
\mathchardef\mathquote=\mathcode`\"
\def\jed@A #1 {\begingroup\mathcode`\.="013B\mathcode`\,="013B \begingroup \mathcode`\e="8000 #1 \jed@B} % numbers written with dot or comma
\def\jed@B #1@@{\endgroup\if @#1@\else\,\mathcode`\.="0201 \mathup{#1}\fi\endgroup}
\begingroup\uccode`~=`"\uppercase{\endgroup\def~}#1"{\jed@A #1 @@}
\mathcode`\"="8000

\@ifpackageloaded{babel}{%
  \PackageWarning{fkssugar}{Package babel detected, macros with active double quote ", will be disabled.}
% -- Uncomment if you need use standard babel double quote macros --
%  \begingroup\uccode`~=`*\uppercase{\endgroup\def~}#1*{\jed@A #1 @@}
%  \mathcode`\*="8000
  \catcode`\"=12
}{%
}}

% == muĺtilang support ==
% TODO
% Fig. vs. Obr. somehow
% == english typeset ==

\def\fkssug@renglish{%
% tg can be used: https://en.wikipedia.org/wiki/Trigonometric_functions

% decimal point
\def\jed@A ##1 {\begingroup\mathcode`\.="013A\mathcode`\,="013A \begingroup \mathcode`\e="8000 ##1 \jed@B} % numbers written with dot or comma

%quotation
\ifdefined\uv\renewcommand\uv[1]{``##1''}\fi
}

% == czech typeset ==
\def\fkssug@rczech{%
% tg implicit

% decimal point
\def\jed@A ##1 {\begingroup\mathcode`\.="013B\mathcode`\,="013B \begingroup \mathcode`\e="8000 ##1 \jed@B} % numbers written with dot or comma

%quotation
\ifdefined\uv\renewcommand\uv[1]{„##1“}\fi
}

% == package options ==
\DeclareOption{english}{%
    \AtBeginDocument{\fkssug@renglish}
}
\DeclareOption{czech}{%
    \AtBeginDocument{\fkssug@rczech}
}
\DeclareOption*{%
    \PackageWarning{examplepackage}{Unknown ‘\CurrentOption’}
}
\ProcessOptions\relax

